<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dozone.wehagopro.repository.mybatis.OrganizationMapper">
    <select id="showMyWorkPlace">
        SELECT
        t_company.t_company_no,
        t_company.t_company_name,
        t_organization.t_organization_no,
        t_organization.t_organization_name,
        (
        SELECT COUNT(t_employee_no) FROM t_employee WHERE t_company_no = t_company.t_company_no AND t_employee_state >= 0
        ) AS company_employee_count,
        (
        SELECT COUNT(t_employee_no) FROM t_employee WHERE t_organization_no = t_organization.t_organization_no AND t_employee_state >= 0
        ) AS organization_employee_count
        FROM
        t_organization
        JOIN
        t_employee ON t_organization.t_organization_parent = t_employee.t_company_no
        JOIN
        t_company ON t_employee.t_company_no = t_company.t_company_no
        WHERE
        t_employee.t_user_no = #{t_user_no};
    </select>
    <select id="showMyEmployeeState" resultType="CountEmployee">
        SELECT
        (
        SELECT COUNT(t_employee_no)
        FROM t_employee
        WHERE t_company_no = #{t_company_no} AND t_employee_state >= 0
        ) AS count_state_all,
        (
        SELECT COUNT(t_employee_no)
        FROM t_employee
        WHERE t_company_no = #{t_company_no} AND t_employee_state = 0
        ) AS count_state_0,
        (
        SELECT COUNT(t_employee_no)
        FROM t_employee
        WHERE t_company_no = #{t_company_no} AND t_employee_state = 1
        ) AS count_state_1,
        (
        SELECT COUNT(t_employee_no)
        FROM t_employee
        WHERE t_company_no = #{t_company_no} AND t_employee_state = 2
        ) AS count_state_2,
        (
        SELECT COUNT(t_employee_no)
        FROM t_employee
        WHERE t_company_no = #{t_company_no} AND t_employee_state = 3
        ) AS count_state_3;
    </select>
    <select id="showMyEmployeeFromCompany" resultType="User">
        select * from t_user where t_user_no IN
        (select t_user_no from t_employee where t_company_no=
        (select t_company_no from t_company where t_company_name=#{t_company_name} and t_company_no=#{t_company_no})
        and
        <choose>
            <when test="t_employee_state == 0">
                t_employee_state = 0
            </when>
            <when test="t_employee_state == 1">
                t_employee_state = 1
            </when>
            <when test="t_employee_state == 2">
                t_employee_state = 2
            </when>
            <when test="t_employee_state == 3">
                t_employee_state = 3
            </when>
            <otherwise>
                t_employee_state >= 0
            </otherwise>
        </choose>
        )
        and t_user_state>=0;
    </select>
    <select id="showMyEmployeeFromOrganization" resultType="User">
        select * from t_user where t_user_no IN
        (select t_user_no from t_employee where t_organization_no=
        (select t_organization_no from t_organization where t_organization_name=#{t_organization_name} and t_organization_no=#{t_organization_no})
        and
        <choose>
            <when test="t_employee_state == 0">
                t_employee_state = 0
            </when>
            <when test="t_employee_state == 1">
                t_employee_state = 1
            </when>
            <when test="t_employee_state == 2">
                t_employee_state = 2
            </when>
            <when test="t_employee_state == 3">
                t_employee_state = 3
            </when>
            <otherwise>
                t_employee_state >= 0
            </otherwise>
        </choose>
        )
        and t_user_state>=0;
    </select>
</mapper>